# RPC Docs

RPC 是远程过程调用，它能帮助我们屏蔽网络编程细节，实现调用远程方法就跟调用本地方法一样的体验，不需要
因为这个方法是远程调用就写很多和业务相关的代码；作用主要体现在两个方面：
- 屏蔽远程调用跟本地调用的区别
- 隐藏底层网络通信的复杂性，让开发者更专注于业务逻辑

## 设计通信协议

RPC 需要使用网络作为媒介向远程的主机发起调用，我们知道网络是分层的，大部分情况下我们都在使用 TCP 协议，
TCP 协议要求传输的数据只能是二进制，也就是说我们需要将要传输的数据转化为二进制，然后传输到远程主机的网卡上，
再经由 TCP 协议把二进制数据交给应用层去处理，这个过程最关键的地方是：如何表示数据？

不用 HTTP 协议而使用 RPC 协议的原因：
- 服务间通信对于性能的要求更高
- 否则没有太多理由用 RPC 而不用 HTTP
- 影响 HTTP 性能的原因
  - HTTP 协议的数据包较大，包含了较多的无用内容，如换行符、回车符等；数据包大必定会耗费更多时间，同时大的数据包
    对于序列化和反序列化也需要更多的 CPU 时间
  - HTTP 是无状态协议，每次请求需要重新建立连接，处理完后关闭连接
    
RPC 私有协议设计：目标是设计一个可"升级"、可扩展的协议，这个很重要

             2 字节 + 4 字节 + 2 字节 + 1 字节 + 1 字节 + 1 字节 = 11字节
BitOffset    0-15   ｜   16-47   ｜  46-63   ｜  64-71  ｜   72-79   ｜ 80-87
0-8         魔术位      整体长度    头部长度     协议版本    消息类型      序列化方式
88-103      消息ID
不固定       协议头扩展字段
协议体       Payload

13 字节的固定头 + 变长的扩展头 + 变长的协议体
